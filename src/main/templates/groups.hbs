{{> header}}
<!-- Main content starts - do not edit above this line -->

<div id="groups-topbar" class="sticky-top border-bottom">
  <div class="container px-3 py-2 bg-white">
    <div id="groupFilterSummary" class="text-muted small mb-1"></div>
    <div id="groupToolbar" class="d-flex flex-wrap align-items-center gap-2">
      <button class="btn btn-outline-secondary d-lg-none" type="button"
        data-bs-toggle="offcanvas" data-bs-target="#groupFacetDrawer" aria-controls="groupFacetDrawer">
        <i class="bi bi-funnel"></i> Filters
      </button>
      <input id="groupSearch" type="search" class="form-control flex-grow-1" placeholder="Search Groups…">
      <div class="input-group input-group-sm w-auto" aria-label="Sort results">
       <select id="groupSort" class="form-select w-auto">
        <option value="groupOrg:asc">Org A→Z</option>
        <option value="groupOrg:desc">Org Z→A</option>
        <option value="groupId:asc">Name A→Z</option>
        <option value="groupId:desc">Name Z→A</option>
        <option value="groupType:asc">Type A→Z</option>
        <option value="groupType:desc">Type Z→A</option>
      </select>
      </div>
      <div class="input-group input-group-sm w-auto" aria-label="Results per page">
        <span class="input-group-text">Per page</span>
        <select id="groupPageSize" class="form-select">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="40" selected>40</option>
          <option value="100">100</option>
        </select>
      </div>
      <div id="groupActiveFilters" class="d-flex flex-wrap align-items-center gap-1"></div>
    </div>
  </div>
</div>

<div class="container mt-3">
  <div class="row g-3">
    <!-- Facets: built dynamically by groups.js from card data -->
    <aside id="groupFacet" class="col-lg-3 d-none d-lg-block"><!-- Facets injected here --></aside>
    <section id="groupCardsMain" class="col-lg-9">
      <div id="groupResultsLine" class="text-muted small mb-2">Showing <strong id="groupResultCount">0</strong> of <strong id="groupTotalCount">0</strong> groups</div>
      <div class="sticky pt-2">
        <nav id="groupPager" class="d-flex justify-content-between align-items-center mb-2">
          <div class="btn-group">
            <button id="groupPrevPage" type="button" class="btn btn-outline-secondary btn-sm">Prev</button>
            <button id="groupNextPage" type="button" class="btn btn-outline-secondary btn-sm">Next</button>
          </div>
          <div id="groupPageNums" class="btn-group"></div>
          <div id="groupPageMeta" class="small text-muted">Page 1 of 1</div>
        </nav>
      </div>
      <div id="groupCards" class="cards"><!-- Cards rendered client-side from normalized groups.json --></div>

      {{{{raw}}}}
      <template id="group-card-tpl-src">
        <article
          class="card-reg group-card"
          data-org="{{groupOrg}}"
          data-type="{{groupType}}"
          data-status="{{statusText}}"
          data-group-id="{{groupId}}"
          data-group-name="{{groupName}}"
          data-group-desc="{{groupDesc}}"
          data-parent-id="{{parentgroupId}}"
          data-tc="{{tcId}}"
        >
          <header class="d-flex align-items-start gap-2 mb-1">
            <a class="anchor" id="{{groupId}}" href="#{{groupId}}"></a>
            <div class="publisher-logo-slot flex-shrink-0 order-0 mt-1">
              {{#if (publisherLink groupOrg)}}
                <a href="{{publisherLink groupOrg}}" target="_blank" rel="noopener">{{publisherLogo groupOrg}}</a>
              {{else}}
                {{publisherLogo groupOrg}}
              {{/if}}
            </div>
            <div class="title-block mb-2 flex-grow-1 order-1">
              <h3 class="h6 mb-1">
                <code class="me-1">{{groupId}}</code>
                <a href="../docs/?f.group={{groupId}}" class="text-decoration-none">
                  <span class="group-label">{{groupLabel}}</span>
                </a>
              </h3>
            </div>
            <div class="status-badges d-flex gap-1 flex-wrap ms-auto justify-content-end text-end order-2">
              {{#if isActive}}
                <span class="badge text-bg-success">Active</span>
              {{else}}
                <span class="badge text-bg-secondary">Closed</span>
              {{/if}}
              {{#if groupType}}
                <span class="badge text-bg-light border">{{groupType}}</span>
              {{/if}}
            </div>
          </header>
          <div class="small text-muted mb-1">
            {{#if parentgroupId}}
              {{#with (groupIdLookup ../data parentgroupId)}}
                <span class="badge-reg">
                  Parent: <a class="group-link clear-filter" href="#{{groupId}}">
                    {{#if groupLabel}}{{groupLabel}}{{else}}{{groupId}}{{/if}}
                  </a>
                </span>
              {{/with}}
            {{/if}}
            {{#if groupLink}}
              <span class="ms-auto">Link: <a href="{{groupLink}}" target="_blank" rel="noopener">{{groupLink}}</a></span>
            {{/if}}
          </div>
          <div class="small mb-2">
            {{groupSummary}}
            {{#ifeq isActive false}}
              <span class="fw-bold small d-block mt-1">
                <em>** NOTE: This group is no longer active{{#if groupStatus.assignedGroup}}; all work and documents (published, in draft, and repos) have been reassigned to:
                  {{#groupStatus.assignedGroup}}
                    {{#unless @first}}, {{/unless}}
                    {{#with (groupIdLookup ../../data this)}}
                      <a class="group-link clear-filter" href="#{{groupId}}">
                        {{#if groupLabel}}{{groupLabel}}{{else}}{{groupId}}{{/if}}
                      </a>
                    {{/with}}
                  {{/groupStatus.assignedGroup}}
                {{/if}}. **</em>
              </span>
            {{/ifeq}}
          </div>
          <div class="small mt-1 d-flex flex-wrap align-items-center gap-2">
            {{#if groupRepo}}
              <a href="{{groupRepo}}" target="_blank" class="badge-reg text-decoration-none">Repo</a>
            {{/if}}
            {{#ifeq groupType "TC"}}
              <a href="../docs/?f.group={{groupId}}" class="badge-reg text-decoration-none">Published Docs</a>
            {{/ifeq}}
            {{#if groupType}}
              <a
                href="../projects/{{../htmlLink}}?search.search={{spaceReplace groupOrg}}{{#if parentgroupId}}{{#with (groupIdLookup ../data parentgroupId)}}%20{{spaceReplace groupName}}{{/with}}{{/if}}%20{{spaceReplace groupName}}{{#if groupDesc}}%20{{spaceReplace groupDesc}}{{/if}}"
                class="badge-reg text-decoration-none"
              >
                Projects
              </a>
            {{/if}}
            {{#if groupDocs}}
              <a href="{{groupDocs}}" target="_blank" class="badge-reg text-decoration-none">Documents</a>
            {{/if}}
            {{#if groupCal}}
              <a href="{{groupCal}}" target="_blank" class="badge-reg text-decoration-none">Calendar</a>
            {{/if}}
            {{#if groupBallots}}
              <a href="{{groupBallots}}" target="_blank" class="badge-reg text-decoration-none">Ballots</a>
            {{/if}}
          </div>
        </article>
      </template>
      {{{{/raw}}}}
      <div id="groupPagerBottom" class="sticky-bottom py-2">
        <nav class="d-flex justify-content-between align-items-center">
          <div class="btn-group">
            <button id="groupPrevPageBottom" type="button" class="btn btn-outline-secondary btn-sm">Prev</button>
            <button id="groupNextPageBottom" type="button" class="btn btn-outline-secondary btn-sm">Next</button>
          </div>
          <div id="groupPageNumsBottom" class="btn-group"></div>
          <div id="groupPageMetaBottom" class="small text-muted">Page 1 of 1</div>
        </nav>
      </div>
    </section>
  </div>
</div>

<!-- Offcanvas drawer for facets on small screens -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="groupFacetDrawer" aria-labelledby="groupFacetDrawerLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="groupFacetDrawerLabel">Filters</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body" id="groupFacetDrawerBody"><!-- Facets cloned here --></div>
</div>

<script src="../js/groups.js"></script>

<!-- Main content ends - do not edit below this line -->
{{> footer}}