{{> header}}

<div id="cards-topbar" class="sticky-top bg-white border-bottom px-3 py-2">
  <div id="filterSummary" class="text-muted small mb-1"></div>
  <div id="toolbar" class="d-flex flex-wrap align-items-center gap-2">
    
    <button class="btn btn-outline-secondary d-lg-none" type="button"
      data-bs-toggle="offcanvas" data-bs-target="#facetDrawer" aria-controls="facetDrawer">
      <i class="bi bi-funnel"></i> Filters
    </button>
    <input id="q" type="search" class="form-control flex-grow-1" placeholder="Search…">
    <select id="sort" class="form-select w-auto">
      <option value="pubDate:desc">Latest</option>
      <option value="pubDate:asc">Oldest</option>
      <option value="label:asc">Label A→Z</option>
      <option value="label:desc">Label Z→A</option>
      <option value="title:asc">Title A→Z</option>
      <option value="title:desc">Title Z→A</option>
    </select>
    <div class="input-group input-group-sm w-auto" aria-label="Filter by year">
      <span class="input-group-text">Year</span>
      <select id="yearSelect" class="form-select">
        <option value="">All years</option>
        <!-- years will be populated dynamically -->
      </select>
    </div>
    <div class="input-group input-group-sm w-auto" aria-label="Results per page">
      <span class="input-group-text">Per page</span>
      <select id="pageSize" class="form-select">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="40" selected>40</option>
        <option value="100">100</option>
      </select>
    </div>
    <div id="activeFilters" class="d-flex flex-wrap align-items-center gap-1"></div>
  </div>
</div>

<div class="container-fluid mt-3">
  <div class="row g-3">
    <aside id="facet" class="col-lg-3 d-none d-lg-block"><!-- Facets injected here --></aside>
    <section id="cards-main" class="col-lg-9">
      <div id="resultsLine" class="text-muted small mb-2">Showing <strong id="resultCount">0</strong> documents</div>
      <div class="sticky bg-white pt-2">
        <nav id="pager" class="d-flex justify-content-between align-items-center mb-2">
          <div class="btn-group">
            <button id="prevPage" type="button" class="btn btn-outline-secondary btn-sm">Prev</button>
            <button id="nextPage" type="button" class="btn btn-outline-secondary btn-sm">Next</button>
          </div>
          <div id="pageNums" class="btn-group"></div>
          <div id="pageMeta" class="small text-muted">Page 1 of 1</div>
        </nav>
      </div>
      <div id="cards" class="cards"></div>
      <div class="sticky-bottom bg-white py-2">
        <nav id="pager-bottom" class="d-flex justify-content-between align-items-center">
          <div class="btn-group">
            <button id="prevPageBottom" type="button" class="btn btn-outline-secondary btn-sm">Prev</button>
            <button id="nextPageBottom" type="button" class="btn btn-outline-secondary btn-sm">Next</button>
          </div>
          <div id="pageNumsBottom" class="btn-group"></div>
          <div id="pageMetaBottom" class="small text-muted">Page 1 of 1</div>
        </nav>
      </div>
    </section>
  </div>
</div>

<!-- Offcanvas drawer for facets on small screens -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="facetDrawer" aria-labelledby="facetDrawerLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="facetDrawerLabel">Filters</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body" id="facetDrawerBody"><!-- Facets cloned here --></div>
</div>

<!-- Inline client-side card template source (inert) -->
{{{{raw}}}}
<template id="card-tpl-src">
  <article class="card-reg">
    <header class="d-flex align-items-start gap-2 mb-1">
      <h3 class="h6 mb-2 flex-grow-1">
        <a class="anchor" id="{{id}}" href="#{{id}}"></a>
        <code class="me-1">{{label}}</code>
        <br>
        <a href="/docs/{{id}}/" class="text-decoration-none">{{title}}</a>
      </h3>
      <div class="d-flex gap-1 flex-wrap ms-auto justify-content-end text-end">
        {{#if (hasAny statusOrdered)}}
          {{#each statusOrdered}}
            {{{statusBadge this}}}
          {{/each}}
        {{else}}
          {{#if (hasAny status)}}
            {{#each status}}
              {{{statusBadge this}}}
            {{/each}}
          {{/if}}
        {{/if}}
      </div>
    </header>

    <div class="meta mb-1 small text-muted d-flex flex-wrap align-items-center gap-1">
      {{#if publisher}}<span class="badge-reg">{{publisher}}</span>{{/if}}
      {{#if docType}}<span class="badge-reg">{{docType}}</span>{{/if}}
      {{#if year}}<span class="badge-reg">{{year}}</span>{{/if}}
      {{#if hasReleaseTag}}<span class="badge-reg">releaseTag</span>{{/if}}
      {{#unless hideGroup}}
        {{#if (hasAny groupNames)}}
          <span class="badge-reg">{{join groupNames ", "}}</span>
        {{/if}}
      {{/unless}}
      {{#if (hasAny currentWork)}}<span class="badge-reg badge-work">{{join currentWork ", "}}</span>{{/if}}
      {{#if doi}}
        <span class="badge-reg">DOI: {{{doiLink doi}}}</span>
      {{/if}}
    </div>

    <div class="small text-muted mt-2 d-flex flex-wrap align-items-center gap-2">
      {{#if pubDate}}
        <span>Published: <span class="fst-italic">{{pubDate}}</span></span>
      {{/if}}
      {{#if href}}
        <span class="ms-auto">Link: <a href="{{href}}" target="_blank" rel="noopener">{{href}}</a></span>
      {{else}}
        {{#unless doi}}
          <span class="ms-auto text-muted">No DOI or link available.</span>
        {{/unless}}
      {{/if}}
    </div>
    {{#if docBase}}
      <div class="small text-muted mt-0">Doc Base: <span class="fst-italic">{{docBaseLabel}}</span></div>
    {{/if}}
    {{#if (hasAny keywords)}}
      <div class="small text-muted mt-0">Keywords: <span class="fst-italic">{{join keywords ", "}}</span></div>
    {{else}}
      {{#if (hasAny keywordsSearch)}}
        <div class="small text-muted mt-0">Keywords: <span class="fst-italic">{{join keywordsSearch ", "}}</span></div>
      {{/if}}
    {{/if}}
  </article>
</template>
{{{{/raw}}}}

<script src="{{#ifnoteq templateName "index"}}../{{/ifnoteq}}js/cards.js"></script>

{{> footer}}